<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <title>Ball Shadow</title>
  <link rel="stylesheet" href="css/main.css" type="text/css" />
  <meta name="viewport" content="width=device-width,user-scalable=0" />
  <style>
  html, body {
    margin:0;
    padding:0;
  }
  video {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    z-index:-1;
  }
  #connect {
    position:absolute;
    bottom:0;
  }
  </style>
</head>
<body>
<video id="camera" autoplay></video>
<!--button id="connect" disabled="true">Connect</button-->
<button id="connect">Connect</button>
<script src="https://skyway.io/dist/0.3/peer.js"></script>
<script>
var peer = new Peer({key: '743eda5e-f6f2-42f1-867e-a7d767c12bd9'});
peer.on('open', function(id) {
  //window.location.hash = id;
});

var mediaStream;

var connectButton = document.getElementById('connect');
connectButton.addEventListener('click', function() {
  var peerId = window.prompt('Input the peer ID.');
  var call = peer.call(peerId, mediaStream);
});

window.addEventListener('load', function() {
  var facing = window.confirm('Do you want to use a rear camera?') ? 'environment' : 'user';

  MediaStreamTrack.getSources(function(sources) {
    var options = {
      video:{
        mandatory:{
          minWidth:480,
          maxWidth:480,
          minHeight:640,
          maxHeight:640,
        }
      }
    };
    sources.forEach(function(source) {
      if (source.kind === 'video' && source.facing === facing) {
        options['video'] = {optional:[{sourceId:source.id}]};
      }
    })

    navigator.webkitGetUserMedia(options,
      function(localMediaStream) {
        var video = document.getElementById('camera');
        video.src = window.URL.createObjectURL(localMediaStream);
        var peerId = window.location.hash.substring(1);
        var call = peer.call(peerId, localMediaStream);
        mediaStream = localMediaStream;
      },
      function(error) {
        console.log(error);
      }
    );
  });
});
</script>
</body>
</html>
